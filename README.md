# vite-plugin-dev-link

ä¸€ä¸ª Vite æ’ä»¶ï¼Œç”¨äºåœ¨å¼€å‘è¿‡ç¨‹ä¸­å°†æœ¬åœ°ç»„ä»¶ç›®å½•é“¾æ¥åˆ°é¡¹ç›®ä¸­ï¼Œæ›¿ä»£ node_modules ä¸­çš„å¯¹åº”åŒ…ã€‚è¿™æ ·å¯ä»¥å®ç°æœ¬åœ°ç»„ä»¶çš„çƒ­æ›´æ–°å’Œå®æ—¶è°ƒè¯•ã€‚

## åŠŸèƒ½ç‰¹æ€§

-   ğŸ”— **æœ¬åœ°é“¾æ¥**: å°†æœ¬åœ°å¼€å‘çš„ç»„ä»¶é“¾æ¥åˆ°é¡¹ç›®ä¸­ï¼Œæ›¿ä»£ node_modules ä¸­çš„åŒ…
-   ğŸ”„ **çƒ­æ›´æ–°**: æ”¯æŒæœ¬åœ°ç»„ä»¶æ–‡ä»¶å˜åŒ–æ—¶çš„çƒ­æ›´æ–°
-   ğŸ“ **çµæ´»é…ç½®**: æ”¯æŒé€šè¿‡ JSON é…ç½®æ–‡ä»¶çµæ´»é…ç½®é“¾æ¥è§„åˆ™
-   ğŸ¯ **ç²¾ç¡®æ§åˆ¶**: å¯ä»¥æŒ‡å®šå…·ä½“çš„æ–‡ä»¶æˆ–ç›®å½•è¿›è¡Œé“¾æ¥
-   ğŸš« **æ’é™¤æ¨¡å¼**: æ”¯æŒæ’é™¤ä¸éœ€è¦çš„æ–‡ä»¶ï¼ˆå¦‚æµ‹è¯•æ–‡ä»¶ã€æ„å»ºæ–‡ä»¶ç­‰ï¼‰
-   ğŸ“ **è¯¦ç»†æ—¥å¿—**: æä¾›è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ï¼Œæ–¹ä¾¿é—®é¢˜æ’æŸ¥
-   ğŸ›¡ï¸ **å®‰å…¨å¯ç”¨**: é€šè¿‡ç¯å¢ƒå˜é‡æ§åˆ¶ï¼Œé¿å…æ„å¤–å¯ç”¨å½±å“æ­£å¸¸å¼€å‘

## å®‰è£…

```bash
npm install vite-plugin-dev-link --save-dev
```

## ä½¿ç”¨æ–¹æ³•

### 1. é…ç½® Vite

åœ¨ `vite.config.ts` ä¸­æ·»åŠ æ’ä»¶ï¼š

```typescript
import { defineConfig } from "vite";
import vitePluginDevLink from "vite-plugin-dev-link";

export default defineConfig({
    plugins: [
        vitePluginDevLink({
            configFile: "dev-link.json", // é…ç½®æ–‡ä»¶è·¯å¾„
            enabled: true, // æ˜¯å¦å¯ç”¨æ’ä»¶
            verbose: true, // æ˜¯å¦æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—
        }),
    ],
});
```

### 2. åˆ›å»ºé…ç½®æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `dev-link.json` é…ç½®æ–‡ä»¶ï¼š

```json
{
    "links": [
        {
            "package": "@my-org/ui-components",
            "localPath": "../ui-components/src",
            "files": [
                "components/Button.tsx",
                "components/Input.tsx",
                "index.ts"
            ],
            "exclude": ["**/*.test.ts", "**/*.stories.ts"]
        },
        {
            "package": "my-utils",
            "localPath": "../my-utils/src",
            "exclude": ["**/*.test.js", "**/*.spec.js"]
        }
    ],
    "globalExclude": [
        "**/*.d.ts",
        "**/*.map",
        "**/node_modules/**",
        "**/.git/**"
    ]
}
```

### 3. è¿è¡Œå¼€å‘æœåŠ¡å™¨

ä½¿ç”¨ç¯å¢ƒå˜é‡å¯ç”¨ dev-link åŠŸèƒ½ï¼š

```bash
DEV_LINK=true npm run dev
```

æˆ–è€…åœ¨ Windows ä¸­ï¼š

```bash
set DEV_LINK=true && npm run dev
```

## é…ç½®é€‰é¡¹

### æ’ä»¶é€‰é¡¹

| é€‰é¡¹         | ç±»å‹      | é»˜è®¤å€¼            | æè¿°             |
| ------------ | --------- | ----------------- | ---------------- |
| `configFile` | `string`  | `'dev-link.json'` | é…ç½®æ–‡ä»¶è·¯å¾„     |
| `enabled`    | `boolean` | `true`            | æ˜¯å¦å¯ç”¨æ’ä»¶     |
| `verbose`    | `boolean` | `false`           | æ˜¯å¦æ˜¾ç¤ºè¯¦ç»†æ—¥å¿— |

### é…ç½®æ–‡ä»¶æ ¼å¼

#### LinkMapping é…ç½®

| å­—æ®µ        | ç±»å‹       | å¿…å¡« | æè¿°                                 |
| ----------- | ---------- | ---- | ------------------------------------ |
| `package`   | `string`   | âœ…   | è¦æ›¿æ¢çš„åŒ…å                         |
| `localPath` | `string`   | âœ…   | æœ¬åœ°æºç è·¯å¾„                         |
| `files`     | `string[]` | âŒ   | æŒ‡å®šè¦é“¾æ¥çš„æ–‡ä»¶ï¼ˆç›¸å¯¹äº localPathï¼‰ |
| `exclude`   | `string[]` | âŒ   | æ’é™¤çš„æ–‡ä»¶æ¨¡å¼                       |

#### å…¨å±€é…ç½®

| å­—æ®µ            | ç±»å‹            | å¿…å¡« | æè¿°         |
| --------------- | --------------- | ---- | ------------ |
| `links`         | `LinkMapping[]` | âœ…   | é“¾æ¥é…ç½®æ•°ç»„ |
| `globalExclude` | `string[]`      | âŒ   | å…¨å±€æ’é™¤æ¨¡å¼ |

## å·¥ä½œåŸç†

1. **ç¯å¢ƒæ£€æµ‹**: æ£€æŸ¥ `DEV_LINK` ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®ä¸º `true`
2. **é…ç½®åŠ è½½**: æ’ä»¶å¯åŠ¨æ—¶è¯»å–é…ç½®æ–‡ä»¶ï¼Œè§£æé“¾æ¥è§„åˆ™
3. **æ¨¡å—è§£æ**: æ‹¦æˆªæ¨¡å—å¯¼å…¥è¯·æ±‚ï¼Œæ£€æŸ¥æ˜¯å¦åŒ¹é…é…ç½®çš„åŒ…å
4. **è·¯å¾„é‡å†™**: å°†åŒ¹é…çš„åŒ…å¯¼å…¥é‡å®šå‘åˆ°æœ¬åœ°æ–‡ä»¶è·¯å¾„
5. **æ–‡ä»¶ç›‘å¬**: ç›‘å¬æœ¬åœ°æ–‡ä»¶å˜åŒ–ï¼Œè§¦å‘çƒ­æ›´æ–°
6. **æ™ºèƒ½åŒ¹é…**: æ”¯æŒåŒ…çš„å­è·¯å¾„å¯¼å…¥å’Œå¤šç§æ–‡ä»¶æ‰©å±•å

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: ç»„ä»¶åº“å¼€å‘

å½“ä½ åœ¨å¼€å‘ä¸€ä¸ªç»„ä»¶åº“ï¼Œå¹¶ä¸”éœ€è¦åœ¨å¦ä¸€ä¸ªé¡¹ç›®ä¸­å®æ—¶æµ‹è¯•æ—¶ï¼š

```json
{
    "links": [
        {
            "package": "@company/ui-kit",
            "localPath": "../ui-kit/src",
            "exclude": ["**/*.test.*", "**/*.stories.*"]
        }
    ]
}
```

### åœºæ™¯ 2: å·¥å…·åº“è°ƒè¯•

è°ƒè¯•å·¥å…·åº“æ—¶åªé“¾æ¥ç‰¹å®šæ¨¡å—ï¼š

```json
{
    "links": [
        {
            "package": "my-utils",
            "localPath": "../utils/src",
            "files": ["index.ts", "debounce.ts", "throttle.ts"]
        }
    ]
}
```

### åœºæ™¯ 3: å¤šåŒ…å¼€å‘

åŒæ—¶å¼€å‘å¤šä¸ªç›¸å…³åŒ…ï¼š

```json
{
    "links": [
        {
            "package": "@company/core",
            "localPath": "../core/src"
        },
        {
            "package": "@company/components",
            "localPath": "../components/src"
        },
        {
            "package": "@company/utils",
            "localPath": "../utils/src"
        }
    ]
}
```

## æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒå˜é‡**: å¿…é¡»è®¾ç½® `DEV_LINK=true` ç¯å¢ƒå˜é‡æ‰èƒ½å¯ç”¨æ’ä»¶åŠŸèƒ½
2. **è·¯å¾„è§£æ**: æœ¬åœ°è·¯å¾„æ”¯æŒç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„
3. **æ–‡ä»¶æ‰©å±•å**: æ’ä»¶ä¼šè‡ªåŠ¨å°è¯• `.ts`, `.tsx`, `.js`, `.jsx`, `.vue` ç­‰æ‰©å±•å
4. **åŒ…æŸ¥æ‰¾**: ä¼˜å…ˆä½¿ç”¨ `require.resolve` æŸ¥æ‰¾åŒ…ï¼Œfallback åˆ° node_modules ç›®å½•
5. **æ€§èƒ½ä¼˜åŒ–**: åªåœ¨å¼€å‘æ¨¡å¼ä¸‹å¯ç”¨ï¼Œä¸å½±å“ç”Ÿäº§æ„å»º
6. **çƒ­æ›´æ–°**: ä¿®æ”¹æœ¬åœ°æ–‡ä»¶æ—¶ä¼šè‡ªåŠ¨è§¦å‘é¡µé¢æ›´æ–°
7. **å®‰å…¨æ€§**: ä¸è®¾ç½®ç¯å¢ƒå˜é‡æ—¶æ’ä»¶ä¸ä¼šå¯ç”¨ï¼Œé¿å…æ„å¤–å½±å“æ­£å¸¸å¼€å‘æµç¨‹

## å¼€å‘

```bash
# å®‰è£…ä¾èµ–
npm install

# å¼€å‘æ’ä»¶ï¼ˆç›‘å¬æ–‡ä»¶å˜åŒ–ï¼‰
npm run dev:plugin

# å¯åŠ¨ç¤ºä¾‹é¡¹ç›®
npm run dev

# å¯ç”¨é“¾æ¥åŠŸèƒ½çš„å¼€å‘æ¨¡å¼
DEV_LINK=true npm run dev

# æ„å»º
npm run build

# æµ‹è¯•
npm run test
```

## è®¸å¯è¯

MIT
